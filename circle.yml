dependencies:
  pre:  
    # Install the console dependencies
    - python -c 'from w3af.core.controllers.dependency_check.dependency_check import dependency_check;dependency_check()'; true
    - if [ -f requirements.txt ]; then pip install -r requirements.txt; fi

    # Install GUI dependencies
    - w3af/w3af/core/controllers/ci/install_gui_dependencies.sh
    
    # Install the test dependencies
    - w3af/w3af/core/controllers/ci/install_test_dependencies.sh

machine:
  python:
    version: 2.7.3
  
  post:
    # This was required to avoid issues with different builds of python being
    # used between the gtk libs installed in /usr/lib/python2.7/dist-packages/
    # and the python which was put inside my virtualenv
    - pyenv global system
    
test:
  override:
    # The order in which these are run doesn't really matter, but I do need to
    # take care of "grouping" (which directory is run) because of an incompatibility
    # between "w3af/core/ui/gui/" and "w3af/core/ui/tests/" which comes from
    # Gtk2 vs. Gtk3.
    - nosetests --with-doctest --doctest-tests -A "smoke and not internet and not moth and not root" w3af/core/controllers/
    - nosetests --with-doctest --doctest-tests -A "smoke and not internet and not moth and not root" w3af/core/data/
    - nosetests --with-doctest --doctest-tests -A "smoke and not internet and not moth and not root" w3af/core/ui/tests/
    - nosetests --with-doctest --doctest-tests -A "smoke and not internet and not moth and not root" w3af/core/ui/console/
    - nosetests --with-doctest --doctest-tests -A "smoke and not internet and not moth and not root" w3af/core/ui/gui/
    - nosetests --with-doctest --doctest-tests -A "smoke and not internet and not moth and not root" w3af/plugins/
        
    # TODO: Run the tests which require moth
